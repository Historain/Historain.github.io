
<!DOCTYPE html>
<html>
<head>
  
  <title>Quick Start - Leaflet</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
  
</head>
<body>
<div class = "panel">
		<select id="selectPlane" class="selectPlane">
			<option>null</option>
		</select> 
		<label id="labelFrom">null</label>
		<label id="labelTo">null</label>
		<label id="labelWhere">null</label>
</div>



<div id="mapid" style="  
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;"></div>
<script>

  var mymap = L.map('mapid').setView([54.74306, 55.96779], 4);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
      '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox.streets'
  }).addTo(mymap);

  var marker = L.marker([54.72498,55.942506]).addTo(mymap) 
.bindPopup("<strong>УГАТУ Корпус №1</strong><br />Адрес: ул. Карла Маркса, 12").openPopup(); 

</script>
  <div class="panel">
		<select id="selectPlane" class="selectPlane">
			<option value="0">Самолет # 0</option>
		<option value="1">Самолет # 1</option><option value="2">Самолет # 2</option><option value="3">Самолет # 3</option><option value="4">Самолет # 4</option><option value="5">Самолет # 5</option><option value="6">Самолет # 6</option><option value="7">Самолет # 7</option><option value="8">Самолет # 8</option><option value="9">Самолет # 9</option><option value="10">Самолет # 10</option><option value="11">Самолет # 11</option><option value="12">Самолет # 12</option><option value="13">Самолет # 13</option><option value="14">Самолет # 14</option></select> 
		<label id="labelFrom">из: Нью-Йорк</label>
		<label id="labelTo">в: Уфа</label>
		<label id="labelWhere">в пути</label>
	</div>
	<script>
    function getRandomArbitary(min, max) //всякие функции
    {
    	return Math.round(Math.random() * (max - min) + min);
    }
    function lerp (start, end, amt){
    	return (1-amt)*start+amt*end;
    }

    function initiatePlaneCity(citiesBegin, citiesEnd, ready, i) {
      if(citiesEnd[i] === undefined) {
        var randomNumber1 = getRandomArbitary(0,citiesName.length - 1);
        citiesBegin[i] =  randomNumber1;
      }
      else citiesBegin[i] = citiesEnd[i];
      var randomNumber2 = getRandomArbitary(0,citiesName.length - 1);
      while(randomNumber2 === randomNumber1) {
        randomNumber2 = getRandomArbitary(0,citiesName.length - 1);
      }
      citiesEnd[i] = randomNumber2;
      ready[i][0] = 0;
      ready[i][1] = 0;
    }

    var map = new ol.Map({
    	layers: [
    	new ol.layer.Tile({
    		source: new ol.source.OSM()
    	})
    	],
    	target: 'map',
    	view: new ol.View({
    		center: [0, 0],
    		zoom: 2
    	})
    });

    var closenPlaneStyle = new ol.style.Style({ 
    	image: new ol.style.Circle({
    		radius: 2.5,
    		snapToPixel: false,
    		fill: new ol.style.Fill({color: 'red'})
    	})
    });

    var planeStyle = new ol.style.Style({ 
    	image: new ol.style.Circle({
    		radius: 2.5,
    		snapToPixel: false,
    		fill: new ol.style.Fill({color: 'blue'})
    	})
    });

    var planeCount = 15;

    selectPlane.length = planeCount;  //записываем в менюшку все самолеты
    for(var i = 0; i < planeCount; i++) {
    	selectPlane.options[i].text = 'Самолет # ' + i.toString();
    	selectPlane.options[i].value = i;
    }

    var citiesBegin = [];
    var citiesEnd = [];
    var ready = [];
    for(var i = 0; i < planeCount; i++) {
     ready.push([0,0]);
   }

    for(var i = 0; i < planeCount; i++) { //выбираем рандомное направление для полетов
      initiatePlaneCity(citiesBegin, citiesEnd, ready, i);
    }
    var coordinates = []; 
    for (var i = 0; i < planeCount; i++) { //выставляем начальные координаты 
    	let x = citiesBase[citiesBegin[i]][0];
    	let y = citiesBase[citiesBegin[i]][1];
    	coordinates.push([x,y]);
    }

    var onetime = 0;

    map.on('postcompose', function(event) {
    	var vectorContext = event.vectorContext;
    	var frameState = event.frameState;

     for (var i = 0; i < planeCount; i++) {
      var x, y;

      var dx = citiesBase[citiesEnd[i]][0] - citiesBase[citiesBegin[i]][0];
      var dy = citiesBase[citiesEnd[i]][1] - citiesBase[citiesBegin[i]][1];
      var length = Math.sqrt(dx*dx + dy*dy);
      x = dx / length;
      y = dy / length;

      if(ready[i][0] === 0 || ready[i][1] === 0) {
        if(coordinates[i][0] < citiesBase[citiesEnd[i]][0] - 10000 || coordinates[i][0] > citiesBase[citiesEnd[i]][0] + 10000)
         coordinates[i][0] += x * 10000;
       else ready[i][0] = getRandomArbitary(20,120);
       if(coordinates[i][1] < citiesBase[citiesEnd[i]][1] - 10000 || coordinates[i][1] > citiesBase[citiesEnd[i]][1] + 10000)
         coordinates[i][1] += y * 10000;
       else ready[i][1] = getRandomArbitary(20,120);
     }

     if(ready[i][0] > 2 && ready[i][1] > 2) {
      ready[i][0] -= 1;
      ready[i][1] -= 1;
    } 
    else if(ready[i][0] > 0 && ready[i][1] > 0) {
      initiatePlaneCity(citiesBegin, citiesEnd, ready, i);
    }
  }

  vectorContext.setStyle(planeStyle);
  vectorContext.drawGeometry(new ol.geom.MultiPoint(coordinates));


     var chosenPlane = new ol.geom.Point(coordinates[selectPlane.value]); //окрашиваем выбранный самолет в другой цвет
     vectorContext.setStyle(closenPlaneStyle);
     vectorContext.drawGeometry(chosenPlane);

     labelFrom.innerHTML = 'из: ' + citiesName[citiesBegin[selectPlane.value]];
     labelTo.innerHTML = 'в: ' + citiesName[citiesEnd[selectPlane.value]];
     if(ready[selectPlane.value][0] != 0 && ready[selectPlane.value][1] != 0) labelWhere.innerHTML = 'ожидает';
     else labelWhere.innerHTML = 'в пути';
     map.render();
   });

    map.render();
  </script>



</body>
</html>
